<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <meta charset="UTF-8">
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <title>产品列表</title>
    <style>
        body {
            font-family: 微软雅黑;
            background: white;
            margin: 0px;
            padding: 0px;
        }

        .title {
            font-size: 15px;
            color: white;
        }

        .head {
            width: 100%;
            height: 44px;
            background-color: black;
            position: relative;
            z-index: 10000;
        }

        .head-left {
            float: left;
            padding-top: 4px;
            padding-left: 0px;
            width: 6%;
            padding-left: 0px;
        }

        .space {
            width: 100%;
            height: 12px;
        }

        .lingshibaocun {
            width: 100%;
            height: 80px;
            display: none;

        }

        .lingshibaocun-left {
            width:80px;
            height: 100%;
            padding: 9px;
            float: left;
        }

        .lingshibaocun-left img {
            width: 100%;
            height:100%;
            text-align: center;
        }

        .lingshibaocun-right1 {
            width: 80%;
            height: 100%;
            padding: 15px 0px 15px 15px;
            border-bottom: 1px solid #eeeeee;
            float: right;
            margin-top: -80px;
        }

        .lingshibaocun-center {
            width: 64%;
            height: 100%;
            float: left;
            font-size: 15px;
            color: black;
            text-align: left;

        }

        .lingshibaocun-right {
            padding: 10px 10px 10px 5px;
            float: right;
        }

        .lingshibaocun-right img {
            width: 20px;
            height: 20px;
            float: right;
        }

        .content-full {
            width: 100%;
            height: auto;
            display: block;
        }

        .content {
            width: 100%;
            height: auto;
            padding: 3px 15px 15px 15px;
            display: inline-table;
        }

        .content1 {
            width: 100%;
            height: auto;
            position: relative;
            z-index: 999;
            overflow: hidden;
        }

        .content1-img {
            width: 100%;
            height: auto;
        }

        .yuanjiao {
            width: 80px;
            height: 80px;
            position: absolute;
            z-index: 1000;
            top: 0px;
        }

        .yuanjiao-img1 {
            width: 70px;
            height: 70px;
            position: absolute;
            z-index: 1000;
        }

        .yuanjiao-img2 {
            width: 30px;
            height: 30px;
            position: absolute;
            z-index: 1001;
            transform: rotate(-45deg);
            margin: 5px;
        }

        .img-state {
            font-size: 13px;
            color: white;
            position: absolute;
            z-index: 1001;
            transform: rotate(-45deg);
            margin-top: 22px;
            margin-left: 10px;
        }

        .font1 {
            font-size: 13px;
            color: white;
            position: absolute;
            z-index: 1001;
        }

        .content-title {
            width: 100%;
            height: 30px;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
            padding-top: 5px;
        }

        .content-price {
            width: 100%;
            height: 20px;
            text-align: center;
            font-size: 12px;
            color: red;
        }

        .xinjian {
            color: white;
            font-size: 15px;
            padding-top: 12px;
            float: right;
        }

        .content-null {
            text-align: center;
            width: 100%;
            height: 400px;
            padding-top: 100px;
            display: block;
            display: none;
        }

        .content-null img {
            width: 100px;
            height: 100px;
        }

        .font1-null {
            font-size: 14px;
            color: rgb(201, 199, 200);
            margin-top: 20px;
        }

        body {
            background-color: white;
        }

        .mui-pull-right, .mui-title, .mui-btn-link {
            font-family: "微软雅黑";
        }

        .titleright {
            margin-top: 13px;
            font-size: 16px;
        }

        .lingshibaocun-left-img-content {
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        .content-full:after {
            content: '';
            display: block;
            clear: both;
        }

        .lingshibaocun {
            content: '';
            display: block;
            clear: both;
        }
    </style>
</head>
<body>
<div class="head">
    <!--<header class="mui-bar mui-bar-nav" style="border-bottom: none; box-shadow: none;background-color: black;">-->
    <!--<a href="sheyingshi-zhuye.html">-->
    <!--<div class="head-left"><img src="../images/product-list/fanhui1.png"></div></a>-->
    <!--<h1 class="mui-title" style="width: 80%;font-size: 15px;color: white">我的产品</h1>-->
    <!--<a href="../PhotoProduct/set"><span class="xinjian">新建</span></a>-->
    <!--</header>-->

    <header class="mui-bar mui-bar-nav" style="border-bottom: 1px solid #dcdcdc;color:black;background-color: white;">
        <a class="mui-icon mui-action-back mui-icon-arrowleft" style="color:black;">
        </a>
        <h1 class="mui-title" style="width: 80%">我的产品</h1>
        <a href="../PhotoProduct/set" class="mui-pull-right titleright" id="save"
           style="color:black;    margin-top: 11px;">新建</a>
    </header>
</div>
<div class="content-null">
    <img src="../images/product-list/box(1).svg">
    <p class="font1-null">您还没有创建任何产品哦</p>
</div>
<div class="content-full">
    <div class="space"></div>
    <div class="lingshibaocun" id="daitijiao">
    </div>
    <div class="space"></div>
    <div class="content" id="yitijiao">
    </div>
</div>
</body>
<script src="../js/mui.min.js"></script>
<script src="../js/server.js"></script>
<script src="../js/date.js"></script>
<script src="../js/commen.js"></script>
<script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" charset="utf-8">
    $(function () {
        getProduct();
    });
    function getProduct() {
        var html = "";
        $.ajax({
            url: "../product/SelectSysCp",
            type: "get",
            dataType: "json",
            timeout: 10000,
            success: function (data) {
                console.log(data);
                var html = "";
                var prolist = data.allCp;
                console.log(prolist);
                if (prolist.length == 0) {
                    $(".content-null").css("display", "block")
                    $(".content-full").css("display", "none")
                } else {
                    $(".content-null").css("display", "none")
                    $(".content-full").css("display", "block")
                    for (var i = 0; i < prolist.length; i++) {
                        if (prolist[i].itemShzt == 0) {
                            html = '<div class="lingshibaocun-left"><div class="lingshibaocun-left-img-content"><img src="' + imgpre + JSON.parse(prolist[i].itemCover)[0].path + '"/></div></div>\
                            <div class="lingshibaocun-right1"><div class="lingshibaocun-center">临时保存</div>\
                                    <div class="lingshibaocun-right delete"><img src="../images/product-list/delete.png" data-id="' + prolist[i].id + '"></div>\
                                     <div class="lingshibaocun-right edit"><img src="../images/product-list/pen.png"></div>';
                            $(".lingshibaocun").css("display", "block")
                            $("#daitijiao").append(html);
                        }
                        else if (prolist[i].itemShzt == 1) {
                            html = '<div class="content1" id="' + prolist[i].id + '">\
                        <img class="content1-img" src="' + imgpre + JSON.parse(prolist[i].itemCover)[0].path + '">\
                                    <div class="yuanjiao">\
                                    	<img class="yuanjiao-img1" src="../images/product-list/banyuan.png">\
                                    <img class="yuanjiao-img2" src="../images/product-list/open.svg">\
                                    <p style="margin-left: 15px;margin-top: 24px" class="img-state">待审核</p>\
                                    </div>\
                                </div>\
                                    <div class="content-title">' + prolist[i].itemName + '</div>\
                                    <div class="content-price">' + prolist[i].itemPrice + '</div>';
                            $("#yitijiao").append(html);
                            $(".content1").css({"height": ($(".content1").width()*0.75)});
                        }

                        else if (prolist[i].itemShzt == 2) {
                            if (prolist[i].itemCpzt = "上线") {
                                html = '<div class="content1" id="' + prolist[i].id + '">\
                        <img class="content1-img" src="' + imgpre + JSON.parse(prolist[i].itemCover)[0].path + '">\
                                    <div class="yuanjiao">\
                                    	<img class="yuanjiao-img1" src="../images/product-list/banyuan.png">\
                                    <img class="yuanjiao-img2" src="../images/product-list/open.svg">\
                                    <p style="margin-left: 15px;margin-top: 24px" class="img-state">上线</p>\
                                    </div>\
                                </div>\
                                    <div class="content-title">' + prolist[i].itemName + '</div>\
                                    <div class="content-price">' + prolist[i].itemPrice + '</div>';
                                $("#yitijiao").append(html);
                                $(".content1").css({"height": ($(".content1").width()*0.75)});
                            } else {
                                html = '<div class="content1" id="' + prolist[i].id + '">\
                        <img class="content1-img" src="' + imgpre + JSON.parse(prolist[i].itemCover)[0].path + '">\
                                    <div class="yuanjiao">\
                                    	<img class="yuanjiao-img1" src="../images/product-list/banyuan.png">\
                                    <img class="yuanjiao-img2" src="../images/product-list/close.svg">\
                                    <p style="margin-left: 15px;margin-top: 24px" class="img-state">下线</p>\
                                    </div>\
                                </div>\
                                    <div class="content-title">' + prolist[i].itemName + '</div>\
                                    <div class="content-price">' + prolist[i].itemPrice + '</div>';
                                $("#yitijiao").append(html);
                                $(".content1").css({"height": ($(".content1").width()*0.75)});
                            }
                        } else if (prolist[i].itemShzt == 3) {
                            html = '<div class="content1" id="' + prolist[i].id + '">\
                        <img class="content1-img" src="' + imgpre + JSON.parse(prolist[i].itemCover)[0].path + '">\
                                    <div class="yuanjiao">\
                                    	<img class="yuanjiao-img1" src="../images/product-list/banyuan.png">\
                                    <img class="yuanjiao-img2" src="../images/product-list/open1.svg">\
                                    <p style="margin-left: 15px;margin-top: 24px" class="img-state">审核未通过</p>\
                                    </div>\
                                </div>\
                                    <div class="content-title">' + prolist[i].itemName + '</div>\
                                    <div class="content-price">' + prolist[i].itemPrice + '</div>';
                            $("#yitijiao").append(html);
                            $(".content1").css({"height": ($(".content1").width()*0.75)});
                        }
                    }
                    var imgs = $(".lingshibaocun-left img");
                    imgs.on("load", function (e) {
                        var $parent = $(e.target).parent();
                        $(".lingshibaocun-right1").css({"width":($(".lingshibaocun").width()-$(".lingshibaocun-left").height())});
                        ($parent.width() / $parent.height() + ":" + e.target.naturalWidth / e.target.naturalHeight);
                        if ($parent.width() / $parent.height() > e.target.naturalWidth / e.target.naturalHeight) {
                            $(e.target).css({
                                "width": "100%",
                                "height": "auto" ,
                                "max_height":"auto" ,
                                "max_width": "auto"
                            });
                            $(e.target).css({"margin-top": ($parent.height() - $(e.target).height()) / 2});
                        } else {
                            $(e.target).css({
                                "width": "auto",
                                "height": "100%",
                                "max_height": "auto",
                                "max_width": "auto"
                            });
                            $(e.target).css({"margin-left": ($parent.width() - $(e.target).width()) / 2});
                        }
                    });
                    for (var i = 0; i < imgs.length; i++) {
                        if (imgs[i].height != 0) {
                            var $parent = $(imgs[i]).parent();
                            if ($parent.width() / $parent.height() > imgs[i].naturalWidth / imgs[i].naturalHeight) {
                                $(imgs[i]).css({
                                    "width": "auto",
                                    "height": "100%",
                                    "max_height": "auto",
                                    "max_width":"auto"
                                });
                                $(imgs[i]).css({"margin-top": ($(imgs[i]).width() - $(imgs[i]).height()) / 2});
                            } else {
                                $(imgs[i]).css({
                                    "width": "100%",
                                    "height": "auto",
                                    "max_height": "auto",
                                    "max_width":"auto"
                                });
                                $(imgs[i]).css({"margin-top": "-" + ($(imgs[i]).width() - $(imgs[i]).height()) / 2});
                            }
                        }
                    }
                    deleteCpById();
                }

            },
            error: function (e) {
                mui.toast(e);
            }
        });
    }
    //    通过id删除产品
    function deleteCpById() {
        $(".delete img").click(function () {
            var btnArray = ['否', '是'];
            var $thisid = $(this).attr("data-id")
            mui.confirm('您确定是否删除该产品？', '立可拍', btnArray, function(e) {
                if (e.index == 1) {
                    mui.toast("删除中！！")
                    $.ajax({
                        url: "../sysPort/deletesyscp",
                        data:{
                            id:$thisid
                        },
                        type: "post",
                        dataType: "json",
                        timeout: 10000,
                        success: function (data) {
                            if(data.errorCode == "200"){
                                mui.toast("删除产品成功")
                                window.location.reload()
                            }else {
                                mui.toast(data.errorMsg)
                            }
                        },
                        error: function (e) {
                            mui.toast("删除失败！！")
                        }
                    });
                }
            });

        });
        $(".edit img").click(function () {
            var $thisid = $(this).parent().prev(".delete").find("img").attr("data-id");
            window.location.href="../PhotoProduct/set?id="+$thisid;
        });
        $(".content1 img").click(function () {
            var $thisid = $(this).parent().attr("id");
            if($thisid)
            window.location.href="../PhotoProduct/set?id="+$thisid;
        });
        $(".yuanjiao").click(function () {
            var $thisid = $(this).parent().attr("id");
            if($thisid)
                window.location.href="../PhotoProduct/set?id="+$thisid;
        })
    }

</script>
</html>